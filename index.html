<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>GenZ Smart ‚Äî Ideas & Feed</title>

<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Poppins:wght@600;700&display=swap" rel="stylesheet">

<style>
  /* ---------------- Basic Theme (Twitter-like) ---------------- */
  :root{
    --bg:#0b1220; --panel:#0f1724; --muted:#98aac6; --text:#e6f0ff;
    --divider: rgba(255,255,255,0.04);
    --accent-blue:#1d9bf0;
    --accent-ghost: rgba(29,155,240,0.14);
    --radius:12px;
    --shadow: 0 6px 18px rgba(2,6,23,0.6);
  }
  .light{ --bg:#f7fafc; --panel:#ffffff; --muted:#6b7280; --text:#0b1220; --divider:rgba(0,0,0,0.06); --accent-blue:#1d4ed8; --shadow:0 6px 18px rgba(12,18,34,0.06); }
  *{box-sizing:border-box;margin:0;padding:0}
  html,body{height:100%}
  body{
    font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;
    background:var(--bg);
    color:var(--text);
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    -webkit-tap-highlight-color:transparent;
  }

  /* app container */
  .app{max-width:820px;margin:0 auto;padding:12px;min-height:100vh;position:relative;z-index:1}

  /* header (sticky) */
  header{position:sticky;top:0;z-index:120;display:flex;align-items:center;justify-content:space-between;padding:10px 6px;background:linear-gradient(180deg, rgba(11,18,32,0.9), rgba(11,18,32,0.65));backdrop-filter:blur(6px);border-bottom:1px solid var(--divider)}
  .brand{display:flex;align-items:center;gap:10px}
  .logo{width:44px;height:44px;border-radius:10px;display:grid;place-items:center;background:var(--accent-blue);font-weight:700;font-family:Poppins}
  .title{font-weight:700;font-family:Poppins;font-size:16px}
  .header-actions{display:flex;align-items:center;gap:10px}
  .icon-btn{background:transparent;border:0;color:var(--text);font-size:18px;padding:8px;border-radius:8px;cursor:pointer}

  /* drawer */
  .drawer-backdrop{position:fixed;inset:0;background:rgba(0,0,0,0.72);backdrop-filter:blur(4px);display:none;z-index:300}
  .drawer{position:fixed;left:-100%;top:0;height:100%;width:84vw;max-width:360px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:18px;border-right:1px solid var(--divider);z-index:310;transition:left .28s cubic-bezier(.2,.9,.2,1)}
  .drawer.open{left:0}
  .drawer .close{background:transparent;border:0;color:var(--text);font-size:20px}
  .drawer a, .drawer button{display:block;padding:12px;border-radius:10px;text-decoration:none;color:var(--text);font-weight:700;border:0;background:transparent;text-align:left;cursor:pointer}
  .drawer a:hover{background:var(--accent-ghost)}

  /* hero */
  .hero{margin-top:10px}
  .hero-card{background:transparent;padding:14px;border-radius:12px}
  .hero-title{font-family:Poppins;font-weight:700;font-size:20px}
  .hero-quote{color:var(--muted);margin-top:6px;font-weight:600}

  /* tabs */
  .tabs{display:flex;gap:8px;align-items:center;padding:12px 0}
  .tab{padding:8px 12px;border-radius:999px;background:transparent;border:0;color:var(--muted);font-weight:700;cursor:pointer}
  .tab.active{color:var(--text);background:rgba(255,255,255,0.02);box-shadow:var(--shadow)}

  /* composer (top of feed) */
  .composer{display:none;margin-top:10px;padding:12px;border-radius:12px;background:var(--panel);border:1px solid var(--divider);box-shadow:var(--shadow)}
  .comp-row{display:flex;gap:12px}
  .comp-avatar{width:48px;height:48px;border-radius:50%;display:grid;place-items:center;background:#223145;color:#fff;font-weight:800}
  .comp-input{flex:1;min-height:64px;padding:10px;border-radius:10px;background:transparent;border:1px solid rgba(255,255,255,0.03);color:var(--text);font-size:15px}
  .comp-meta{display:flex;justify-content:space-between;align-items:center;margin-top:8px}
  .btn-blue{background:var(--accent-blue);color:#fff;padding:8px 12px;border-radius:999px;border:0;font-weight:700;cursor:pointer}
  .btn-ghost{background:transparent;border:1px solid rgba(255,255,255,0.03);padding:6px 10px;border-radius:8px;color:var(--muted);cursor:pointer}

  /* feed -> single column */
  .feed{margin-top:12px;border-top:1px solid var(--divider)}
  .tweet{display:flex;gap:12px;padding:12px;border-bottom:1px solid var(--divider);align-items:flex-start}
  .tweet:hover{background:rgba(255,255,255,0.01)}
  .tweet .avatar{width:48px;height:48px;border-radius:50%;display:grid;place-items:center;background:#152233;font-weight:800;color:#fff;flex-shrink:0}
  .tweet .body{flex:1}
  .title-link{font-weight:800;color:var(--text);text-decoration:none;display:block;font-size:15px}
  .meta{color:var(--muted);font-size:12px;margin-top:6px}
  .content{margin-top:8px;color:var(--text);line-height:1.5;white-space:pre-wrap}
  .read-more{color:var(--accent-blue);font-weight:700;cursor:pointer;margin-left:6px;font-size:13px}

  /* single post view */
  .post-view{display:none;margin-top:12px;padding:14px;background:var(--panel);border-radius:12px;border:1px solid var(--divider)}
  .post-title{font-family:Poppins;font-weight:700;font-size:20px}
  .post-meta{color:var(--muted);font-size:13px;margin-top:6px}
  .post-content{margin-top:12px;line-height:1.6}

  /* about (profile style) */
  .about-banner{height:110px;border-radius:12px;background:linear-gradient(90deg,#233b6b,#1d9bf0);position:relative;overflow:hidden}
  .about-hero{margin-top:-36px;padding:12px;display:flex;gap:12px;align-items:center}
  .about-hero .avatar{width:88px;height:88px;border-radius:50%;background:#fff;display:grid;place-items:center;color:#111;font-size:34px}
  .about-hero .name{font-weight:800;font-family:Poppins}
  .about-bio{margin-top:10px;color:var(--muted);line-height:1.6;background:var(--panel);padding:12px;border-radius:12px;border:1px solid var(--divider)}

  /* footer */
  footer{margin-top:20px;padding:18px;text-align:center;color:var(--muted);font-size:13px;border-top:1px solid var(--divider)}

  /* toast */
  .toast-wrap{position:fixed;right:16px;bottom:16px;z-index:500;display:flex;flex-direction:column;gap:10px}
  .toast{padding:10px 12px;border-radius:10px;background:rgba(0,0,0,0.7);color:#fff}

  /* reveal animations */
  .reveal{opacity:0;transform:translateY(8px);transition:opacity .45s ease, transform .45s ease}
  .reveal.in{opacity:1;transform:none}

  /* responsive tweaks */
  @media(min-width:980px){
    .app{padding:18px}
    .title{font-size:18px}
    .post-title{font-size:26px}
  }
</style>
</head>
<body>

<div class="drawer-backdrop" id="drawerBackdrop" style="display:none"></div>
<nav id="drawer" class="drawer" aria-hidden="true">
  <button id="closeDrawer" class="close" aria-label="Close menu">‚úï</button>
  <div style="margin-top:10px;font-weight:800;font-family:Poppins">GenZ Smart</div>
  <div style="height:1px;background:var(--divider);margin:10px 0"></div>
  <div class="nav">
    <a href="#" data-view="home">üè† Home</a>
    <a href="#" data-view="blog">üì∞ Blog <span id="blogCount" style="margin-left:8px;font-weight:700;color:var(--muted)">0</span></a>
    <a href="#" data-view="about">üë§ About</a>
    <div style="height:1px;background:var(--divider);margin:10px 0"></div>
    <button id="openLogin">üîê Admin Login</button>
    <div style="height:1px;background:var(--divider);margin:10px 0"></div>
    <div style="font-size:13px;color:var(--muted)">Follow</div>
    <div style="display:flex;gap:8px;margin-top:8px">
      <a href="https://youtube.com/@calizenowais?si=y5c2lp6JfCjSiJXB" target="_blank" style="color:var(--text);text-decoration:none;font-weight:700">YouTube</a>
      <a href="https://www.instagram.com/owaisdar_511?igsh=MWV6d21lbjVpNXh6Yg==" target="_blank" style="color:var(--text);text-decoration:none;font-weight:700">Instagram</a>
    </div>
  </div>
</nav>

<div class="app" role="application" aria-label="GenZ Smart">

  <!-- header -->
  <header>
    <div class="brand">
      <div class="logo">GZ</div>
      <div>
        <div class="title">GenZ Smart</div>
        <div style="font-size:12px;color:var(--muted)">Ideas ‚Ä¢ Thoughts ‚Ä¢ Motivation</div>
      </div>
    </div>
    <div class="header-actions">
      <button id="themeToggle" class="icon-btn" title="Toggle theme">üåì</button>
      <button id="menuBtn" class="icon-btn" title="Menu">‚ò∞</button>
    </div>
  </header>

  <!-- hero -->
  <section class="hero reveal">
    <div class="hero-card">
      <div class="hero-title">Ideas that spark. Thoughts that grow.</div>
      <div class="hero-quote" id="heroQuote">‚ÄúSmall steps every day lead to big results.‚Äù</div>
    </div>
  </section>

  <!-- tabs -->
  <div class="tabs" role="tablist" aria-label="Views">
    <button class="tab active" data-view="home">Home</button>
    <button class="tab" data-view="blog">Blog <span id="badgeCount" style="margin-left:8px;font-weight:700;color:var(--muted)">0</span></button>
    <button class="tab" data-view="about">About</button>
  </div>

  <!-- composer (admin only) -->
  <section id="composer" class="composer reveal" aria-hidden="true" style="display:none">
    <div class="comp-row">
      <div class="comp-avatar">üí°</div>
      <div style="flex:1">
        <textarea id="composeText" class="comp-input" placeholder="What's happening?"></textarea>
        <div class="comp-meta">
          <div style="display:flex;gap:8px">
            <input id="composeTitle" class="small-input" placeholder="Title (optional)" style="min-width:160px" />
            <input id="composeAvatarUrl" class="small-input" placeholder="Avatar URL (optional)" style="min-width:160px" />
          </div>
          <div style="display:flex;gap:8px">
            <button id="cancelCompose" class="btn-ghost">Cancel</button>
            <button id="publishBtn" class="btn-blue">Publish</button>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- home view -->
  <main id="homeView" class="view reveal" style="margin-top:12px">
    <div style="display:flex;justify-content:space-between;align-items:end">
      <div>
        <h3 style="margin:0">Home</h3>
        <div style="color:var(--muted);font-size:13px">Only posts from the last 7 days appear here.</div>
      </div>
      <div>
        <button id="refreshBtn" class="icon-btn" title="Refresh">‚ü≥</button>
      </div>
    </div>
    <section id="homeFeed" class="feed" aria-live="polite" style="margin-top:12px"></section>
  </main>

  <!-- blog view -->
  <section id="blogView" class="view reveal" style="display:none; margin-top:12px">
    <div style="display:flex;justify-content:space-between;align-items:flex-end">
      <div>
        <h3 style="margin:0">Blog</h3>
        <div style="color:var(--muted);font-size:13px">All posts stored forever.</div>
      </div>
      <div>
        <button id="backHome" class="icon-btn" title="Back">‚Üê</button>
      </div>
    </div>
    <section id="allFeed" class="feed" style="margin-top:12px"></section>
  </section>

  <!-- single post view -->
  <article id="postView" class="post-view reveal" style="display:none">
    <button id="postBack" class="icon-btn" style="margin-bottom:10px">‚¨Ö Back</button>
    <div style="display:flex;gap:12px;align-items:flex-start">
      <div class="avatar" id="postAvatar" style="width:64px;height:64px;border-radius:50%;background:#152233;display:grid;place-items:center">üí°</div>
      <div style="flex:1">
        <h2 id="postTitle" class="post-title" style="margin:0;font-family:Poppins"></h2>
        <div id="postMeta" class="post-meta"></div>
        <div id="postContent" class="post-content"></div>
        <div id="postAdminActions" style="margin-top:12px"></div>
      </div>
    </div>
  </article>

  <!-- about -->
  <section id="aboutView" class="view reveal" style="display:none;margin-top:12px">
    <div class="about-banner"></div>
    <div class="about-hero">
      <div class="avatar">üí°</div>
      <div>
        <div class="name" style="font-weight:800;font-family:Poppins">Owais Ahmad</div>
        <div style="color:var(--muted);font-size:13px">Ideas ‚Ä¢ Notes ‚Ä¢ Motivation</div>
      </div>
    </div>
    <div class="about-bio">
      <p><strong>About Me</strong></p>
      <p>Hey! I'm <strong>Owais Ahmad</strong>, a student from Kashmir. I share short ideas and motivational notes to help you grow. This space stores everything in the blog forever.</p>
      <div style="margin-top:10px;display:flex;gap:8px">
        <a href="https://youtube.com/@calizenowais?si=y5c2lp6JfCjSiJXB" target="_blank" style="background:var(--accent-blue);color:#fff;padding:8px 12px;border-radius:999px;text-decoration:none;font-weight:700">YouTube</a>
        <a href="https://www.instagram.com/owaisdar_511?igsh=MWV6d21lbjVpNXh6Yg==" target="_blank" style="background:transparent;border:1px solid var(--divider);color:var(--text);padding:8px 12px;border-radius:999px;text-decoration:none;font-weight:700">Instagram</a>
      </div>
    </div>
  </section>

  <footer>
    ¬© <span id="year"></span> GenZ Smart ‚Äî Made with ‚ù§ in Kashmir
  </footer>
</div>

<!-- toasts -->
<div class="toast-wrap" id="toastWrap" aria-live="polite"></div>

<!-- FIREBASE + APP LOGIC -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
  import { getFirestore, collection, addDoc, updateDoc, deleteDoc, doc, onSnapshot, query, orderBy, serverTimestamp, getDoc } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

  // Firebase config (preserved)
  const firebaseConfig = {
    apiKey: "AIzaSyAgjMRRlmsOlX5EsNbPLmFAYrDxKmIEmUc",
    authDomain: "genz-owaisblog.firebaseapp.com",
    databaseURL: "https://genz-owaisblog-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "genz-owaisblog",
    storageBucket: "genz-owaisblog.firebasedatabase.app",
    messagingSenderId: "104507541594",
    appId: "1:104507541594:web:b4212217a4cedc83927063"
  };
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // DOM helpers
  const qs = s => document.querySelector(s);
  const qsa = s => Array.from(document.querySelectorAll(s));
  const el = id => document.getElementById(id);

  // elements
  const menuBtn = qs('#menuBtn'), drawer = qs('#drawer'), drawerBackdrop = qs('#drawerBackdrop'), closeDrawer = qs('#closeDrawer');
  const tabs = qsa('.tab'), homeView = qs('#homeView'), blogView = qs('#blogView'), aboutView = qs('#aboutView');
  const homeFeed = qs('#homeFeed'), allFeed = qs('#allFeed');
  const composer = qs('#composer'), composeText = qs('#composeText'), composeTitle = qs('#composeTitle'), composeAvatarUrl = qs('#composeAvatarUrl');
  const publishBtn = qs('#publishBtn') || qs('#publishBtn'), cancelCompose = qs('#cancelCompose'), refreshBtn = qs('#refreshBtn'), backHome = qs('#backHome');
  const postView = qs('#postView'), postTitle = qs('#postTitle'), postMeta = qs('#postMeta'), postContent = qs('#postContent'), postAvatar = qs('#postAvatar'), postAdminActions = qs('#postAdminActions');
  const postBack = qs('#postBack');
  const openLogin = qs('#openLogin'), loginScreen = qs('#loginScreen'), loginEmail = qs('#loginEmail'), loginPass = qs('#loginPass'), loginSubmit = qs('#loginSubmit'), loginCancel = qs('#loginCancel');
  const themeToggle = qs('#themeToggle');
  const badgeCount = el('badgeCount'), blogCount = el('blogCount'), yearEl = el('year');
  yearEl.textContent = new Date().getFullYear();

  // state
  let isAdmin = false;
  let currentView = 'home';
  let lastViewBeforePost = 'home';

  // admin credentials (same as before)
  const ADMIN_EMAIL = 'saffanakbar942@gmail.com';
  const ADMIN_PASS = 'saffan942';

  // theme
  if(localStorage.siteTheme === undefined) localStorage.siteTheme = 'dark';
  applyTheme(localStorage.siteTheme);
  themeToggle.addEventListener('click', ()=> applyTheme(localStorage.siteTheme === 'dark' ? 'light' : 'dark'));
  function applyTheme(t){
    if(t === 'light') document.documentElement.classList.add('light'); else document.documentElement.classList.remove('light');
    localStorage.siteTheme = t;
  }

  // drawer open/close
  menuBtn.addEventListener('click', ()=> { drawer.classList.add('open'); drawerBackdrop.style.display='block'; });
  closeDrawer.addEventListener('click', ()=> { drawer.classList.remove('open'); drawerBackdrop.style.display='none'; });
  drawerBackdrop.addEventListener('click', ()=> { drawer.classList.remove('open'); drawerBackdrop.style.display='none'; });

  // tabs
  tabs.forEach(t => {
    t.addEventListener('click', () => {
      tabs.forEach(x => x.classList.remove('active')); t.classList.add('active');
      const view = t.getAttribute('data-view');
      if(view === 'home') showHome();
      if(view === 'blog') showBlog();
      if(view === 'about') showAbout();
      drawer.classList.remove('open'); drawerBackdrop.style.display='none';
    });
  });

  function hideAll(){ homeView.style.display='none'; blogView.style.display='none'; aboutView.style.display='none'; postView.style.display='none'; }
  function showHome(){ hideAll(); homeView.style.display='block'; currentView='home'; document.title='GenZ Smart ‚Äî Ideas & Feed'; window.scrollTo({top:0,behavior:'smooth'}); }
  function showBlog(){ hideAll(); blogView.style.display='block'; currentView='blog'; document.title='GenZ Smart ‚Äî Blog'; window.scrollTo({top:0,behavior:'smooth'}); }
  function showAbout(){ hideAll(); aboutView.style.display='block'; currentView='about'; document.title='GenZ Smart ‚Äî About'; window.scrollTo({top:0,behavior:'smooth'}); }
  backHome?.addEventListener('click', showHome);

  // login screen (dedicated) - create on demand (not visible until clicked)
  // We'll show a small in-app modal for admin login when menu -> Admin Login clicked
  const loginModal = (() => {
    const wrap = document.createElement('div');
    wrap.style.cssText = 'position:fixed;inset:0;display:none;place-items:center;z-index:400;background:linear-gradient(180deg,rgba(0,0,0,0.6),rgba(0,0,0,0.35))';
    wrap.id = 'loginModal';
    const card = document.createElement('div');
    card.style.cssText = 'width:92%;max-width:420px;background:var(--panel);padding:18px;border-radius:12px;border:1px solid rgba(255,255,255,0.03);box-shadow:var(--shadow)';
    card.innerHTML = `<h3 style="margin:0 0 8px;font-family:Poppins">üí° GenZ Smart ‚Äî Admin</h3>
      <p style="margin:0 0 12px;color:var(--muted)">Sign in to publish and manage posts.</p>
      <div style="display:flex;flex-direction:column;gap:8px">
        <input id="lmEmail" class="small-input" placeholder="Admin email" />
        <input id="lmPass" class="small-input" placeholder="Password" type="password" />
        <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:6px">
          <button id="lmCancel" class="icon-btn" style="background:transparent;border-radius:8px;padding:8px;border:1px solid rgba(255,255,255,0.06)">Cancel</button>
          <button id="lmSubmit" class="icon-btn" style="background:var(--accent-blue);color:#fff;padding:8px 12px;border-radius:8px">Sign in</button>
        </div>
      </div>`;
    wrap.appendChild(card);
    document.body.appendChild(wrap);
    return wrap;
  })();

  // show login on menu click
  openLogin.addEventListener('click', ()=> {
    drawer.classList.remove('open'); drawerBackdrop.style.display = 'none';
    loginModal.style.display = 'grid';
    const lmEmail = document.getElementById('lmEmail'), lmPass = document.getElementById('lmPass'), lmCancel = document.getElementById('lmCancel'), lmSubmit = document.getElementById('lmSubmit');
    lmEmail.value = ''; lmPass.value = '';
    lmCancel.onclick = ()=> loginModal.style.display = 'none';
    lmSubmit.onclick = ()=> {
      const em = lmEmail.value?.trim(), pw = lmPass.value?.trim();
      if(!em || !pw){ toast('Enter email & password','err'); return; }
      if(em !== ADMIN_EMAIL || pw !== ADMIN_PASS){ toast('Invalid credentials','err'); return; }
      isAdmin = true;
      loginModal.style.display = 'none';
      composer.style.display = 'block';
      toast('‚ú® Admin signed in ‚Äî composer unlocked', 'ok');
      setTimeout(()=> composer.scrollIntoView({behavior:'smooth', block:'center'}), 150);
    };
  });

  // helpers
  function toast(msg, type='ok'){
    const wrap = el('toastWrap');
    const d = document.createElement('div'); d.className = 'toast';
    if(type==='ok') d.textContent = '‚ú® ' + msg;
    else if(type==='edit') d.textContent = '‚úèÔ∏è ' + msg;
    else if(type==='del') d.textContent = 'üóëÔ∏è ' + msg;
    else if(type==='err') { d.textContent = msg; d.style.background = 'linear-gradient(90deg,var(--danger),#ff7b7b)'; }
    else d.textContent = msg;
    wrap.appendChild(d); setTimeout(()=> d.remove(), 3200);
  }

  function escapeHtml(s){ return (s||'').toString().replace(/[&<>\"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }
  function linkifySafe(text){ const esc = escapeHtml(text); return esc.replace(/(https?:\/\/[^\s]+)/g, u => `<a href="${u}" target="_blank" rel="noopener" style="color:var(--accent-blue)">${u}</a>`); }
  function within7Days(ts){ if(!ts) return true; const t = ts.toMillis ? ts.toMillis() : (+ts||Date.now()); return (Date.now()-t) <= 7*24*60*60*1000; }
  function clearChildren(n){ while(n.firstChild) n.removeChild(n.firstChild); }

  // default avatar
  const DEFAULT_AVATAR = 'üí°';

  // Firestore posts ref
  const postsRef = collection(db, 'posts');

  // create tweet element
  function createTweetEl(docSnap){
    const data = docSnap.data();
    const when = data.timestamp?.toDate ? data.timestamp.toDate() : new Date();
    const article = document.createElement('article'); article.className = 'tweet reveal';
    const left = document.createElement('div'); left.className = 'avatar'; left.textContent = data.avatar ? '' : DEFAULT_AVATAR;
    if(data.avatar){
      const img = document.createElement('img'); img.src = data.avatar; img.style.width='48px'; img.style.height='48px'; img.style.objectFit='cover'; img.style.borderRadius='50%';
      img.onerror = ()=> { left.textContent = DEFAULT_AVATAR; };
      left.appendChild(img);
    }
    const right = document.createElement('div'); right.className = 'body';
    if(data.title && data.title.toString().trim() !== ''){
      const a = document.createElement('a'); a.className = 'title-link'; a.href = '#'; a.textContent = data.title;
      a.addEventListener('click', (e)=>{ e.preventDefault(); openSinglePost(docSnap.id, data); });
      right.appendChild(a);
    }
    const meta = document.createElement('div'); meta.className = 'meta'; meta.textContent = when.toDateString();
    right.appendChild(meta);

    const contentDiv = document.createElement('div'); contentDiv.className = 'content';
    const fullText = data.content || '';
    if(fullText.length <= 100){
      contentDiv.innerHTML = linkifySafe(fullText);
    } else {
      const truncated = fullText.slice(0,100);
      contentDiv.innerHTML = linkifySafe(truncated) + '‚Ä¶';
      const more = document.createElement('span'); more.className = 'read-more'; more.textContent = ' Read more';
      let expanded = false;
      more.addEventListener('click', ()=> {
        expanded = !expanded;
        if(expanded){ contentDiv.innerHTML = linkifySafe(fullText); more.textContent = ' Show less'; contentDiv.appendChild(more); }
        else { contentDiv.innerHTML = linkifySafe(truncated) + '‚Ä¶'; more.textContent = ' Read more'; contentDiv.appendChild(more); }
      });
      contentDiv.appendChild(more);
    }
    right.appendChild(contentDiv);

    // admin actions
    if(isAdmin){
      const actions = document.createElement('div'); actions.style.marginTop = '8px';
      const edit = document.createElement('button'); edit.className='btn-ghost'; edit.textContent='Edit';
      const del = document.createElement('button'); del.className='btn-ghost'; del.textContent='Delete';
      edit.onclick = async ()=> {
        const d = await getDoc(doc(db,'posts',docSnap.id));
        if(!d.exists()){ toast('Not found','err'); return; }
        const pd = d.data();
        composeText.value = pd.content || ''; composeTitle.value = pd.title || ''; composeAvatarUrl.value = pd.avatar || '';
        let existing = el('editId'); if(existing) existing.remove();
        const hid = document.createElement('input'); hid.type='hidden'; hid.id='editId'; hid.value = docSnap.id; document.body.appendChild(hid);
        composer.style.display = 'block'; setTimeout(()=> composer.scrollIntoView({behavior:'smooth', block:'center'}),120);
      };
      del.onclick = async ()=> {
        if(!confirm('Delete this post?')) return;
        try{ await deleteDoc(doc(db,'posts',docSnap.id)); toast('Post deleted','del'); } catch(e){ toast(e.message,'err'); }
      };
      actions.appendChild(edit); actions.appendChild(del);
      right.appendChild(actions);
    }

    article.appendChild(left); article.appendChild(right);
    return article;
  }

  // open single post
  function openSinglePost(id, data){
    postTitle.textContent = data.title && data.title.toString().trim() !== '' ? data.title : 'Untitled';
    postContent.innerHTML = linkifySafe(data.content || '');
    const when = data.timestamp?.toDate ? data.timestamp.toDate() : new Date();
    postMeta.textContent = `GenZ Owais ‚Äî ${when.toDateString()}`;
    postAvatar.innerHTML = '';
    if(data.avatar){
      const im = document.createElement('img'); im.src = data.avatar; im.style.width='100%'; im.style.height='100%'; im.style.objectFit='cover'; im.style.borderRadius='50%';
      im.onerror = ()=> postAvatar.textContent = DEFAULT_AVATAR;
      postAvatar.appendChild(im);
    } else postAvatar.textContent = DEFAULT_AVATAR;

    postAdminActions.innerHTML = '';
    if(isAdmin){
      const edit = document.createElement('button'); edit.className='btn-ghost'; edit.textContent='Edit';
      const del = document.createElement('button'); del.className='btn-ghost'; del.textContent='Delete';
      edit.onclick = async ()=> {
        const d = await getDoc(doc(db,'posts',id));
        if(!d.exists()){ toast('Not found','err'); return; }
        const pd = d.data(); composeText.value = pd.content || ''; composeTitle.value = pd.title || ''; composeAvatarUrl.value = pd.avatar || '';
        let existing = el('editId'); if(existing) existing.remove();
        const hid = document.createElement('input'); hid.type='hidden'; hid.id='editId'; hid.value = id; document.body.appendChild(hid);
        composer.style.display='block'; setTimeout(()=> composer.scrollIntoView({behavior:'smooth', block:'center'}),120);
      };
      del.onclick = async ()=> {
        if(!confirm('Delete this post?')) return;
        try{ await deleteDoc(doc(db,'posts',id)); toast('Post deleted','del'); showHome(); } catch(e){ toast(e.message,'err'); }
      };
      postAdminActions.appendChild(edit); postAdminActions.appendChild(del);
    }

    // hide other views
    homeView.style.display='none'; blogView.style.display='none'; aboutView.style.display='none';
    postView.style.display='block';
    lastViewBeforePost = currentView || 'home';
    document.title = 'GenZ Smart ‚Äî ' + (data.title || 'Post');
    window.scrollTo({top:0,behavior:'smooth'});
  }

  postBack.addEventListener('click', ()=> {
    if(lastViewBeforePost === 'blog') showBlog(); else showHome();
    document.title = 'GenZ Smart ‚Äî Ideas & Feed';
  });

  // realtime start
  let unsub = null;
  function startRealtime(){
    clearChildren(homeFeed); clearChildren(allFeed);
    const loading = document.createElement('div'); loading.className='empty'; loading.innerHTML = '<div style="display:inline-flex;gap:6px"><div style="width:8px;height:8px;border-radius:50%;background:var(--muted)"></div><div style="width:8px;height:8px;border-radius:50%;background:var(--muted)"></div><div style="width:8px;height:8px;border-radius:50%;background:var(--muted)"></div></div>';
    homeFeed.appendChild(loading); allFeed.appendChild(loading.cloneNode(true));
    if(unsub) unsub();
    const q = query(postsRef, orderBy('timestamp','desc'));
    unsub = onSnapshot(q, snap => {
      clearChildren(homeFeed); clearChildren(allFeed);
      const docs = snap.docs || [];
      const total = docs.length || 0;
      if(badgeCount) badgeCount.textContent = total;
      if(blogCount) blogCount.textContent = total;
      if(docs.length === 0){
        const e = document.createElement('div'); e.className = 'empty'; e.textContent = 'No posts yet.'; allFeed.appendChild(e);
      } else {
        docs.forEach(d => allFeed.appendChild(createTweetEl(d)));
      }
      const recent = docs.filter(d => within7Days(d.data().timestamp));
      if(recent.length === 0){
        const e = document.createElement('div'); e.className = 'empty'; e.textContent = 'No posts in the last 7 days.'; homeFeed.appendChild(e);
      } else {
        recent.forEach(d => homeFeed.appendChild(createTweetEl(d)));
      }
      setTimeout(()=> qsa('.reveal').forEach(x => x.classList.add('in')), 80);
    }, err => {
      clearChildren(homeFeed); clearChildren(allFeed);
      const e = document.createElement('div'); e.className='empty'; e.textContent = 'Error loading posts: ' + err.message;
      homeFeed.appendChild(e); allFeed.appendChild(e.cloneNode(true));
    });
  }

  // publish/edit
  publishBtn.addEventListener('click', async ()=> {
    const content = (composeText.value || '').trim();
    const title = (composeTitle.value || '').trim();
    const avatar = (composeAvatarUrl.value || '').trim();
    if(!content){ toast('Write something before publishing','err'); return; }
    try{
      const existing = el('editId');
      if(existing){
        await updateDoc(doc(db,'posts',existing.value), { title, content, avatar });
        existing.remove();
        toast('Post updated','edit');
      } else {
        await addDoc(postsRef, { title, content, avatar, author:'GenZ Owais', timestamp: serverTimestamp() });
        toast('New post published successfully', 'ok');
      }
      composeText.value=''; composeTitle.value=''; composeAvatarUrl.value='';
      composer.style.display = 'none';
    } catch(e){ toast(e.message,'err'); }
  });
  cancelCompose.addEventListener('click', ()=> {
    composeText.value=''; composeTitle.value=''; composeAvatarUrl.value='';
    const existing = el('editId'); if(existing) existing.remove();
    composer.style.display='none';
  });

  // avatar preview - optional (keeps display simple)
  composeAvatarUrl.addEventListener('input', ()=> {
    // no heavy preview required; composer avatar stays static emoji
  });

  // refresh
  refreshBtn.addEventListener('click', ()=> { startRealtime(); toast('Refreshed','ok'); });

  // intersection observer reveals
  const io = new IntersectionObserver(entries => {
    entries.forEach(en => { if(en.isIntersecting){ en.target.classList.add('in'); io.unobserve(en.target); }});
  }, { threshold: .12 });

  // start
  startRealtime();
  showHome();
  setTimeout(()=> qsa('.reveal').forEach(r => io.observe(r)), 200);

  // ESC closes drawer/login
  document.addEventListener('keydown', e => {
    if(e.key === 'Escape'){ loginModal.style.display = 'none'; drawer.classList.remove('open'); drawerBackdrop.style.display = 'none'; }
  });

  // accessibility hint: if composeText gets focus and not admin, nudge login
  composeText.addEventListener('focus', ()=> {
    if(!isAdmin) toast('Open Menu ‚Üí Admin Login to publish', 'err');
  });

  // cleanup on unload
  window.addEventListener('beforeunload', ()=> { if(unsub) unsub(); });

</script>

</body>
</html>
